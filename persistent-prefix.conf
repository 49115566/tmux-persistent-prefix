# ============================================================================
# Tmux Persistent Prefix Mode Configuration
# ============================================================================
# This file should be sourced from your main ~/.tmux.conf
#
# Add to your ~/.tmux.conf:
#   source-file /path/to/persistent-prefix.conf
#
# Or use the install.sh script to do it automatically
# ============================================================================

# Initialize persistent prefix state
set-environment -g TMUX_PERSISTENT_PREFIX 0

# Configuration variables
%if "#{==:#{PERSISTENT_PREFIX_SCRIPTS_PATH},}"
    PERSISTENT_PREFIX_SCRIPTS_PATH="~/.tmux/persistent-prefix"
%endif

# Bind activation key - Change C-p if it conflicts with your setup
bind-key -T prefix C-p \
    set-environment -g TMUX_PERSISTENT_PREFIX 1 \; \
    set-option -g status-style "bg=colour208,fg=black,bold" \; \
    set-option -g status-right "#[bg=yellow,fg=black,bold] âŒ¨  PERSISTENT MODE âŒ¨  #[default] %H:%M" \; \
    display-message "ðŸ”’ Persistent Mode ON - Press Ctrl+p or Esc to exit" \; \
    switch-client -T persistent-prefix

# ============================================================================
# Persistent Prefix Key Table
# ============================================================================

# Exit persistent mode
bind-key -T persistent-prefix C-p \
    set-environment -g TMUX_PERSISTENT_PREFIX 0 \; \
    set-option -g status-style "bg=green,fg=black" \; \
    set-option -g status-right "\"#{=21:pane_title}\" %H:%M %d-%b-%y" \; \
    display-message "ðŸ”“ Persistent Mode OFF"

bind-key -T persistent-prefix Escape \
    set-environment -g TMUX_PERSISTENT_PREFIX 0 \; \
    set-option -g status-style "bg=green,fg=black" \; \
    set-option -g status-right "\"#{=21:pane_title}\" %H:%M %d-%b-%y" \; \
    display-message "ðŸ”“ Persistent Mode OFF"

# Control keys
bind-key -T persistent-prefix C-b run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh send-prefix"
bind-key -T persistent-prefix C-o run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh rotate-window"
bind-key -T persistent-prefix C-z run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh suspend-client"

# Space and special characters
bind-key -T persistent-prefix Space run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh next-layout"
bind-key -T persistent-prefix ! run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh break-pane"
bind-key -T persistent-prefix '"' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh split-window"
bind-key -T persistent-prefix '#' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh list-buffers"
bind-key -T persistent-prefix '$' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'command-prompt -I \"#S\" { rename-session \"%%\" }'"
bind-key -T persistent-prefix % run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh split-window -h"
bind-key -T persistent-prefix & run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'confirm-before -p \"kill-window #W? (y/n)\" kill-window'"
bind-key -T persistent-prefix "'" run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'command-prompt -T window-target -p index { select-window -t \"::%%\" }'"
bind-key -T persistent-prefix ( run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh switch-client -p"
bind-key -T persistent-prefix ) run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh switch-client -n"
bind-key -T persistent-prefix , run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'command-prompt -I \"#W\" { rename-window \"%%\" }'"
bind-key -T persistent-prefix - run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh delete-buffer"
bind-key -T persistent-prefix . run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'command-prompt -T target { move-window -t \"%%\" }'"
bind-key -T persistent-prefix / run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'command-prompt -k -p key { list-keys -1N \"%%\" }'"

# Number keys (0-9)
bind-key -T persistent-prefix 0 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=0"
bind-key -T persistent-prefix 1 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=1"
bind-key -T persistent-prefix 2 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=2"
bind-key -T persistent-prefix 3 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=3"
bind-key -T persistent-prefix 4 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=4"
bind-key -T persistent-prefix 5 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=5"
bind-key -T persistent-prefix 6 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=6"
bind-key -T persistent-prefix 7 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=7"
bind-key -T persistent-prefix 8 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=8"
bind-key -T persistent-prefix 9 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-window -t :=9"

# More special characters
bind-key -T persistent-prefix : run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh command-prompt"
bind-key -T persistent-prefix ';' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh last-pane"
bind-key -T persistent-prefix = run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh choose-buffer -Z"
bind-key -T persistent-prefix ? run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh list-keys -N"

# Lowercase letters
bind-key -T persistent-prefix c run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh new-window"
bind-key -T persistent-prefix d run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh detach-client"
bind-key -T persistent-prefix f run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'command-prompt { find-window -Z \"%%\" }'"
bind-key -T persistent-prefix i run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh display-message"
bind-key -T persistent-prefix l run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh last-window"
bind-key -T persistent-prefix m run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -m"
bind-key -T persistent-prefix n run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh next-window"
bind-key -T persistent-prefix o run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -t :.+"
bind-key -T persistent-prefix p run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh previous-window"
bind-key -T persistent-prefix r run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh refresh-client"
bind-key -T persistent-prefix x run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'confirm-before -p \"kill-pane #P? (y/n)\" kill-pane'"
bind-key -T persistent-prefix z run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -Z"

# MODAL COMMANDS: Exit persistent mode to allow their native keys
bind-key -T persistent-prefix [ run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh copy-mode"
bind-key -T persistent-prefix PPage run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh copy-mode -u"
bind-key -T persistent-prefix q run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh display-panes"
bind-key -T persistent-prefix t run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh clock-mode"
bind-key -T persistent-prefix s run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh choose-tree -Zs"
bind-key -T persistent-prefix w run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh choose-tree -Zw"

# Uppercase letters
bind-key -T persistent-prefix C run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh customize-mode -Z"
bind-key -T persistent-prefix D run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-modal-exit.sh choose-client -Z"
bind-key -T persistent-prefix E run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-layout -E"
bind-key -T persistent-prefix L run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh switch-client -l"
bind-key -T persistent-prefix M run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -M"

# Brackets and braces
bind-key -T persistent-prefix ] run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh paste-buffer -p"
bind-key -T persistent-prefix '{' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh swap-pane -U"
bind-key -T persistent-prefix '}' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh swap-pane -D"
bind-key -T persistent-prefix '~' run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh show-messages"

# Arrow keys
bind-key -T persistent-prefix Up run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -U"
bind-key -T persistent-prefix Down run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -D"
bind-key -T persistent-prefix Left run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -L"
bind-key -T persistent-prefix Right run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-pane -R"

# Alt+number for layouts
bind-key -T persistent-prefix M-1 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-layout even-horizontal"
bind-key -T persistent-prefix M-2 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-layout even-vertical"
bind-key -T persistent-prefix M-3 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-layout main-horizontal"
bind-key -T persistent-prefix M-4 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-layout main-vertical"
bind-key -T persistent-prefix M-5 run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh select-layout tiled"

# Alt+other keys
bind-key -T persistent-prefix M-n run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh next-window -a"
bind-key -T persistent-prefix M-o run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh rotate-window -D"
bind-key -T persistent-prefix M-p run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh previous-window -a"

# Alt+Arrow for large resizing
bind-key -T persistent-prefix M-Up run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -U 5"
bind-key -T persistent-prefix M-Down run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -D 5"
bind-key -T persistent-prefix M-Left run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -L 5"
bind-key -T persistent-prefix M-Right run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -R 5"

# Ctrl+Arrow for fine resizing
bind-key -T persistent-prefix C-Up run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -U"
bind-key -T persistent-prefix C-Down run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -D"
bind-key -T persistent-prefix C-Left run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -L"
bind-key -T persistent-prefix C-Right run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh resize-pane -R"

# Shift+Arrow for scrolling
bind-key -T persistent-prefix S-Up run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh refresh-client -U 10"
bind-key -T persistent-prefix S-Down run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh refresh-client -D 10"
bind-key -T persistent-prefix S-Left run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh refresh-client -L 10"
bind-key -T persistent-prefix S-Right run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh refresh-client -R 10"

# Special keys
bind-key -T persistent-prefix DC run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh refresh-client -c"

# Complex menu bindings
bind-key -T persistent-prefix < run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'display-menu -T \"#[align=centre]#{window_index}:#{window_name}\" -x W -y W \"#{?#{>:#{session_windows},1},,-}Swap Left\" l { swap-window -t :-1 } \"#{?#{>:#{session_windows},1},,-}Swap Right\" r { swap-window -t :+1 } \"#{?pane_marked_set,,-}Swap Marked\" s { swap-window } \"\" Kill X { kill-window } Respawn R { respawn-window -k } \"#{?pane_marked,Unmark,Mark}\" m { select-pane -m } Rename n { command-prompt -F -I \"#W\" { rename-window -t \"#{window_id}\" \"%%\" } } \"\" \"New After\" w { new-window -a } \"New At End\" W { new-window }'"

bind-key -T persistent-prefix > run-shell "#{PERSISTENT_PREFIX_SCRIPTS_PATH}/exec-and-return.sh 'display-menu -T \"#[align=centre]#{pane_index} (#{pane_id})\" -x P -y P \"#{?#{m/r:(copy|view)-mode,#{pane_mode}},Go To Top,}\" < { send-keys -X history-top } \"#{?#{m/r:(copy|view)-mode,#{pane_mode}},Go To Bottom,}\" > { send-keys -X history-bottom } \"\" \"#{?mouse_word,Search For #[underscore]#{=/9/...:mouse_word},}\" C-r { if-shell -F \"#{?#{m/r:(copy|view)-mode,#{pane_mode}},0,1}\" \"copy-mode -t=\" ; send-keys -X -t = search-backward \"#{q:mouse_word}\" } \"#{?mouse_word,Type #[underscore]#{=/9/...:mouse_word},}\" C-y { copy-mode -q ; send-keys -l \"#{q:mouse_word}\" } \"#{?mouse_word,Copy #[underscore]#{=/9/...:mouse_word},}\" c { copy-mode -q ; set-buffer \"#{q:mouse_word}\" } \"#{?mouse_line,Copy Line,}\" l { copy-mode -q ; set-buffer \"#{q:mouse_line}\" } \"\" \"#{?mouse_hyperlink,Type #[underscore]#{=/9/...:mouse_hyperlink},}\" C-h { copy-mode -q ; send-keys -l \"#{q:mouse_hyperlink}\" } \"#{?mouse_hyperlink,Copy #[underscore]#{=/9/...:mouse_hyperlink},}\" h { copy-mode -q ; set-buffer \"#{q:mouse_hyperlink}\" } \"\" \"Horizontal Split\" h { split-window -h } \"Vertical Split\" v { split-window -v } \"\" \"#{?#{>:#{window_panes},1},,-}Swap Up\" u { swap-pane -U } \"#{?#{>:#{window_panes},1},,-}Swap Down\" d { swap-pane -D } \"#{?pane_marked_set,,-}Swap Marked\" s { swap-pane } \"\" Kill X { kill-pane } Respawn R { respawn-pane -k } \"#{?pane_marked,Unmark,Mark}\" m { select-pane -m } \"#{?#{>:#{window_panes},1},,-}#{?window_zoomed_flag,Unzoom,Zoom}\" z { resize-pane -Z }'"

# ============================================================================
# Additional recommended settings (optional)
# ============================================================================
set-option -g mouse on
set-option -g history-limit 10000
set-option -g display-time 3000
set-option -g display-panes-time 3000
set-option -g repeat-time 0

# ============================================================================
# End of Persistent Prefix Configuration
# ============================================================================
